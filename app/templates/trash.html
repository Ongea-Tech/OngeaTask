{% extends "index.html" %}

{% block content %}
<div class="mb-5">
  <h1 class="text-3xl font-bold h-14">Trash</h1>
  <hr class="border-t border-gray-300">
</div>
<div class="h-6"></div>

{% if today_deleted or yesterday_deleted %}
<!-- top controls -->
<div class="row px-4 mb-6">
<div class="flex items-center gap-14 ps-4 mb-6">
  <input type="checkbox" class="custom-checkbox master-checkbox w-14"/>

  <form method="POST" action="{{ url_for('routes.restore_bulk') }}" class="inline">
    <input type="hidden" name="all_task_ids" id="all-restore-ids">
    <button type="submit" class="text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:ring-blue-300 font-medium rounded-sm text-base px-5 py-2.5 text-center cursor-pointer">
      Restore
    </button>
  </form>

  <form method="POST" action="{{ url_for('routes.delete_tasks_permanently') }}" class="inline">
    <input type="hidden" name="all_task_ids" id="all-delete-ids">
   <button type="submit" formaction="{{ url_for('routes.delete_tasks_permanently') }}" class="text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:ring-blue-300 font-medium rounded-sm text-base px-5 py-2.5 text-center cursor-pointer">
          Delete Permanently
        </button>
  </form>
</div>
</div>
{% endif %}

<!-- Today -->
{% if today_deleted %}
<div class="h-6"></div>
<section class="mb-8">
  <h2 class="text-2xl font-semibold h-15">Today ({{ today_date }})</h2>
  <div class="h-2"></div>

  {% for task in today_deleted %}
  <div class="w-full h-24 bg-white rounded-xl shadow-sm flex items-center px-4 text-lg font-medium gap-4 mb-5">
    <input type="checkbox" name="task_ids" value="{{ task.id }}" class="task-checkbox custom-checkbox w-14"/>
    <div class="flex-grow">
      <span class="inline-block text-sm font-semibold py-1 px-2 rounded mb-0.5
            {% if task.category | lower == 'home' %}bg-yellow-200
            {% elif task.category | lower == 'work' %}bg-red-200
            {% else %}bg-gray-200{% endif %}">
        {{ task.category }}
      </span>
      <p class="text-gray-800">
        {{ task.title }}<br/>
        {% if task.subtask_summary %}
        <small class="text-gray-500 font-normal">{{ task.subtask_summary }}</small>
        {% endif %}
      </p>
    </div>
    <div class="w-2.5 h-full rounded-r-xl ml-auto -mr-2
          {% if task.color == 'red' %}bg-red-500
          {% elif task.color == 'yellow' %}bg-yellow-400
          {% elif task.color == 'gray' %}bg-gray-400
          {% endif %}"></div>
   </div>
  <div class="h-6"></div>
  {% endfor %}
</section>
{% endif %}

<!-- Yesterday -->
{% if yesterday_deleted %}
<div class="h-1"></div>
<section class="mb-8">
  <h2 class="text-2xl font-semibold h-14">Yesterday ({{ yesterday_date }})</h2>
  <div class="h-1"></div>

  {% for task in yesterday_deleted %}
  <div class="w-full h-24 bg-white rounded-xl shadow-sm flex items-center px-4 text-lg font-medium gap-4 mb-5">
    <input type="checkbox" name="task_ids" value="{{ task.id }}" class="task-checkbox custom-checkbox w-14"/>
    <div class="flex-grow">
      <span class="inline-block text-sm font-semibold py-1 px-2 rounded mb-0.5
            {% if task.category | lower == 'home' %}bg-yellow-200
            {% elif task.category | lower == 'work' %}bg-red-200
            {% else %}bg-gray-200{% endif %}">
        {{ task.category }}
      </span>
      <p class="text-gray-800">
        {{ task.title }}<br/>
        {% if task.subtask_summary %}
          <small class="text-gray-500 font-normal">{{ task.subtask_summary }}</small>
        {% endif %}
      </p>
    </div>
    <div class="w-2.5 h-full rounded-r-xl ml-auto -mr-2
          {% if task.color == 'red' %}bg-red-500
          {% elif task.color == 'yellow' %}bg-yellow-400
          {% elif task.color == 'gray' %}bg-gray-400
          {% endif %}"></div>
  </div>
  {% endfor %}
</section>
{% endif %}

{% if not today_deleted and not yesterday_deleted %}
<p class="text-center text-slate-500 py-10">Nothing in Trash.</p>
{% endif %}

<!-- checkbox -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const master   = document.querySelector('.master-checkbox');
  const boxes    = [...document.querySelectorAll('.task-checkbox')];
  const restoreI = document.getElementById('all-restore-ids');
  const deleteI  = document.getElementById('all-delete-ids');

  function syncHidden() {
    const ids = boxes.filter(b => b.checked).map(b => b.value).join(',');
    restoreI.value = ids;
    deleteI.value  = ids;
  }

  master.addEventListener('change', () => {
    boxes.forEach(b => (b.checked = master.checked));
    syncHidden();
  });

  boxes.forEach(b => b.addEventListener('change', () => {
    master.checked = boxes.every(x => x.checked);
    syncHidden();
  }));

  syncHidden();  
});
</script>
{% endblock %}